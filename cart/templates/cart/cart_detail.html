{% extends '_base.html' %}

{% load i18n %}
{% load humanize %}
{% load farsi_tags %}
{% load static %}
{% load global_tags %}

{% block title %}{% translate 'Shopping Cart' %}{% endblock title %}

{% block mini_cart_icon %}{% include 'cart/mini_cart_icon_alone.html' %}{% endblock %}

{% block content %}

    {% trans 'Shopping cart' as header_name %}
    {% include 'header.html' with header1=header_name %}

    <!-- Main Content Wrapper Start -->
    <div class="main-content-wrapper">
        <div class="page-content-inner ptb--80">
            <div class="container">
                {% if cart %}

                    <div class="row">
                        <div class="col-lg-8 mb-md--50">
                                <div class="row no-gutters">
                                    <div class="col-12">
                                        <div class="table-content table-responsive">
                                            <table class="table text-center">
                                                <thead>
                                                    <tr>
                                                        <th>&nbsp;</th>
                                                        <th>{% trans 'Product Cover' %}</th>
                                                        <th class="text-left">{% trans 'Product Name' %}</th>
                                                        <th>{% trans 'Price' %}</th>
                                                        <th>{% trans 'Quantity' %}</th>
                                                        <th>{% trans 'Total' %}</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                {% for item in my_cart %}
                                                    {% with item.product_obj as product %}
                                                    <tr>
                                                        <td class="product-remove text-left"><a href="{% url 'cart:cart_remove' item.variant_obj.id %}"><i class="flaticon flaticon-cross"></i></a></td>
                                                        <td class="product-thumbnail text-left">

                                                            <img src="{% if product.covers.exists %}
                                                                {{ product.covers.first.cover.url }}
                                                                {% else %}{% static 'img/products/prod-10-70x88.jpg' %}
                                                                {% endif %}" alt="Product Thumnail">
                                                        </td>
                                                        <td class="product-name wide-column">
                                                            <h3>
                                                                <a href="{{ product.get_absolute_url }}">{{ product.title }}</a>
                                                            </h3>
                                                        </td>
                                                        <td class="product-price-wrapper">
                                                            {% if product.offer %}
                                                                <span class="money-separator"></span>
                                                                <span class="old-price text-danger">
                                                                    <span class="money text-danger">{{ product.price|intcomma:False|number_farsi }} {% trans 'Toman' %}</span>
                                                                </span>
                                                                <span class="money text-success">{{ product.offer_price|intcomma:False|number_farsi }} {% trans 'Toman' %}</span>
                                                            {% else %}
                                                                <span class="money">{{ product.price|intcomma:False|number_farsi }} {% trans 'Toman' %}</span>
                                                            {% endif %}
                                                        </td>
                                                        <td class="product-quantity">
                                                            <form action="{% url 'cart:cart_update' product.id %}" method="POST">
                                                                {% csrf_token %}
                                                                <div class="quantity">
                                                                    <input type="number" class="quantity-input" name="quantity" id="qty-1" value="{{ item.quantity }}" min="1" max="30">
                                                                    {{ item.form.variant_id }}
                                                                </div>
                                                                <button type="submit" class="btn btn-no-bg">{% trans 'Update' %}</button>
                                                            </form>
                                                        </td>
                                                        <td class="product-total-price">
                                                            <span class="product-price-wrapper">
                                                                <span class="money">{{product.offer_price|multiply:item.quantity|intcomma:False|number_farsi }} {% trans 'Toman' %}</span>
                                                            </span>
                                                        </td>
                                                    </tr>
                                                {% endwith %}
                                                {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="row no-gutters border-top pt--20 mt--20">
                                    <div class="col-sm-6 text-sm-right">
                                        <a href="{% url 'cart:cart_clear' %}" class="cart-form__btn">{% trans 'Clear cart' %}</a>
                                    </div>
                                </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="cart-collaterals">
                                <div class="cart-totals">
                                    <h5 class="font-size-14 font-bold mb--15">{% trans 'Total' %}</h5>
                                    <div class="cart-calculator">
                                        <div class="cart-calculator__item">
                                            <div class="cart-calculator__item--head">
                                                <span>{% trans 'Total' %}</span>
                                            </div>
                                            <div class="cart-calculator__item--value">
                                                <span>{{ my_cart.get_total_price_no_offer|intcomma:False|number_farsi }} {% trans 'Toman' %}</span>
                                            </div>
                                        </div>
                                        <div class="cart-calculator__item order-total">
                                            <div class="cart-calculator__item--head">
                                                <span>{% trans 'Total with offer' %}</span>
                                            </div>
                                            <div class="cart-calculator__item--value">
                                                <span class="product-price-wrapper">
                                                    <span class="money">{{ my_cart.get_total_price }} {% trans 'Toman' %}</span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <a href="{% url 'orders:order_create' %}" class="btn btn-danger btn-fullwidth btn-bg-red btn-color-white btn-hover-2">
                                    {% trans 'Order Registration' %}
                                </a>
                            </div>
                        </div>
                    </div>

                {% else %}

                    <div class="container" style="text-align: center; font-size: 20px">
                        <h1>{% trans 'Your shopping cart is empty' %}</h1>
                        <a href="{% url 'products:product_list' %}" class="btn btn-outline-primary btn-fullwidth">Go to Products list</a>
                    </div>

                {% endif %}
            </div>
        </div>
    </div>
    <!-- Main Content Wrapper Start -->


{% endblock content %}